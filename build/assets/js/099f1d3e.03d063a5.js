"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[740],{8373:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>u,frontMatter:()=>t,metadata:()=>a,toc:()=>l});var o=s(4848),r=s(8453);const t={sidebar_position:3},i="Troubleshooting for Daily Operations",a={id:"ops/troubleshoot",title:"Troubleshooting for Daily Operations",description:"Database",source:"@site/docs/ops/troubleshoot.mdx",sourceDirName:"ops",slug:"/ops/troubleshoot",permalink:"/0.61.81-suruasucod-nitb/docs/ops/troubleshoot",draft:!1,unlisted:!1,editUrl:"https://github.com/b-tin/0.61.81-suruasucod-nitb/tree/main/docs/ops/troubleshoot.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Dockerfile For Programming Languages",permalink:"/0.61.81-suruasucod-nitb/docs/ops/dockerfiles"},next:{title:"Programming Languages",permalink:"/0.61.81-suruasucod-nitb/docs/category/programming-languages"}},d={},l=[{value:"Database",id:"database",level:2},{value:"1.1. MySQL: Permission Denied When Restoring Database",id:"11-mysql-permission-denied-when-restoring-database",level:3},{value:"Problem",id:"problem",level:4},{value:"Error Message",id:"error-message",level:4},{value:"Solution",id:"solution",level:4},{value:"Reference",id:"reference",level:4},{value:"1.2. MySQL: Permission Denied When Executing Default Procedures",id:"12-mysql-permission-denied-when-executing-default-procedures",level:3},{value:"Problem",id:"problem-1",level:4},{value:"Error Message",id:"error-message-1",level:4},{value:"Solution",id:"solution-1",level:4}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"troubleshooting-for-daily-operations",children:"Troubleshooting for Daily Operations"}),"\n",(0,o.jsx)(n.h2,{id:"database",children:"Database"}),"\n",(0,o.jsx)(n.h3,{id:"11-mysql-permission-denied-when-restoring-database",children:"1.1. MySQL: Permission Denied When Restoring Database"}),"\n",(0,o.jsx)(n.h4,{id:"problem",children:"Problem"}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsx)(n.p,{children:"An error occurs when attempting to restore the database or tables from a snapshot or backup in the AWS Aurora Cluster with MySQL engine version 5.7."})}),"\n",(0,o.jsx)(n.h4,{id:"error-message",children:"Error Message"}),"\n",(0,o.jsx)(n.admonition,{type:"danger",children:(0,o.jsx)(n.p,{children:"Access denied; you need (at least one of) the SUPER or\nSYSTEM_VARIABLES_ADMIN privilege(s) for this operation"})}),"\n",(0,o.jsx)(n.h4,{id:"solution",children:"Solution"}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsxs)(n.p,{children:["To resolve this issue, please try to dump the database or tables again with the ",(0,o.jsx)(n.code,{children:"--set-gtid-purged=OFF"})," option."]})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-jsx",metastring:'title="/scrips/dump_mysql.sh"',children:"{\n  export DB_BACKUP_DATE=$(date \"+%Y%m%d%H%M%S\")\n  export DB_HOST='database.xxxx.us-east-1.rds.amazonaws.com'\n  export DB_NAME='db_name'\n  export DB_PASSWORD='db_username'\n  export DB_USERNAME='db_username'\n\n  mysqldump \\\n    -h $DB_HOST \\\n    -u $DB_USERNAME \\\n    -p${DB_PASSWORD} \\\n    --column-statistics=0 \\\n    // highlight-start\n    --set-gtid-purged=OFF \\\n    // highlight-end\n    --databases $DB_NAME \\\n    > ${DB_NAME}.backup.${DB_BACKUP_DATE}.sql\n}\n"})}),"\n",(0,o.jsx)(n.h4,{id:"reference",children:"Reference"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://dba.stackexchange.com/questions/317261/access-denied-you-need-at-least-one-of-the-super-or-system-variables-admin-pr",children:"dba.stackexchange.com"})}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"12-mysql-permission-denied-when-executing-default-procedures",children:"1.2. MySQL: Permission Denied When Executing Default Procedures"}),"\n",(0,o.jsx)(n.h4,{id:"problem-1",children:"Problem"}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:["An error occurs when executing the default procedure from the database in the AWS Aurora Cluster with MySQL engine version 5.7. Current user ",(0,o.jsx)(n.code,{children:"foo_user_ro"})," has permission ",(0,o.jsx)(n.code,{children:"SELECT"})," only on the database ",(0,o.jsx)(n.code,{children:"foo_database"})," with all tables."]})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"+-----------------------------------------------------------------------------+\n| Grants for ingestion_6585_user_ro@%                                         |\n+-----------------------------------------------------------------------------+\n| GRANT USAGE ON *.* TO 'foo_user_ro'@'%'                                     |\n| GRANT SELECT ON `foo_database`.* TO 'foo_user_ro'@'%'                       |\n+-----------------------------------------------------------------------------+\n"})}),"\n",(0,o.jsx)(n.h4,{id:"error-message-1",children:"Error Message"}),"\n",(0,o.jsx)(n.admonition,{type:"danger",children:(0,o.jsx)(n.p,{children:"mysql error: execute command denied to user 'foo_user_ro'@'%' for routine 'foo_database.STDEV_SAMP'"})}),"\n",(0,o.jsx)(n.h4,{id:"solution-1",children:"Solution"}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsxs)(n.p,{children:["To resolve this issue, please try to add permission ",(0,o.jsx)(n.code,{children:"EXECUTE"}),"."]})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-jsx",children:"// highlight-start\nGRANT EXECUTE ON foo_database.* TO 'foo_user_ro'@'%';\n// highlight-end\nFLUSH PRIVILEGES;\n\n\n// example query with default procedure\nSELECT age, STDDEV_SAMP(age), STDDEV(age), std(age), STDDEV_pop(age), count(*)\nFROM tmp_table_age\nGROUP BY table_name;\n"})})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>a});var o=s(6540);const r={},t=o.createContext(r);function i(e){const n=o.useContext(t);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),o.createElement(t.Provider,{value:n},e.children)}}}]);